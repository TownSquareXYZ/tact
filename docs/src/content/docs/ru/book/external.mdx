---
title: Внешние сообщения
description: '"Внешние сообщения не имеют отправителя и могут быть отправлены кем угодно offchain'
---

:::caution
  Эта страница находится на реконструкции в соответствии с [#384](https://github.com/tact-lang/tact-docs/issues/384). Все ссылки-якоря (`#`) могут измениться в будущем!
:::

:::caution
  Поддержка внешних сообщений должна быть явно включена в конфигурации проекта.
  Без ее включения компиляция завершится неудачей.
:::

Внешние сообщения — это те, которые не имеют отправителя и могут быть отправлены кем угодно в мире. Внешние сообщения являются хорошими инструментами для интеграции с off-chain системами или для общего поддержания контрактов. Обработка внешних сообщений отличается от обработки внутренних сообщений. В этом разделе мы рассмотрим, как обрабатывать внешние сообщения.

## Чем отличаются внешние сообщения

Внешние сообщения отличаются от внутренних следующим образом:

### Контракты сами оплачивают использование газа

При обработке внутренних сообщений отправитель обычно оплачивает потребление газа. При обработке внешних сообщений контракт оплачивает потребление газа. Это означает, что вам нужно быть осторожным с потреблением газа во внешних сообщениях. Вы всегда должны проверять потребление газа вашими контрактами и проверять, что все работает так, как задумано.

### Сообщения должны быть приняты вручную

Внешние сообщения не принимаются автоматически. Вам необходимо принять их вручную. Это делается путем вызова функции `acceptMessage`. Если вы не вызовете функцию `acceptMessage`, сообщение будет отклонено. Это сделано для предотвращения рассылки спама.

### Лимит газа в 10 тыс. до принятия сообщения

10 тыс. газа — это очень маленький лимит, и сам Tact может потреблять значительное количество газа, прежде чем он даже достигнет вашего кода. Вам всегда следует проверять использование газа вашими контрактами и проверять, что все работает так, как задумано.

:::tip[Hey there!]

  Лимит газа в 10 тыс. для внешних сообщений основан на параметре, который устанавлен валидатором для всего блокчейна в поле `gas_limit`. Вы можете взять ссылку здесь:

- https://docs.ton.org/develop/smart-contracts/guidelines/accept#external-messages
- https://docs.ton.org/develop/howto/blockchain-configs#param-20-and-21

:::

### Неограниченное использование газа после принятия сообщения

После принятия газа, контракт может использовать его столько, сколько ему нужно. Это сделано для того, чтобы контракт мог выполнять любые виды обработки. Всегда проверяйте использование газа в своих контрактах и убедитесь, что все работает так, как задумано, а также избегать возможных уязвимостей, которые могут привести к истощению баланса контракта.

### Недоступен контекст

При обработке внешнего сообщения функции `context` и `sender` недоступны. Это связано с тем, что для внешних сообщений контекст отсутствует. Это означает, что вы не можете использовать функции `context` и `sender` во внешних сообщениях. Вам необходимо тщательно протестировать свой контракт, чтобы убедиться, что в нем не используются функции `context` и `sender`.

## Включить поддержку внешних сообщений

Чтобы включить поддержку внешних сообщений, включите ее в файл конфигурации проекта:

```json
{
  "options": {
    "external": true
  }
}
```

## Внешние приемники

Внешние приемники определяются так же, как и внутренние, но с использованием ключевого слова `external` вместо `receive`:

```tact
contract SampleContract {
    external("Check Timeout") {

        // Проверка времени ожидания контракта
        require(self.timeout > now(), "Not timeouted");

        // Принять сообщение
        acceptMessage();

        // Обработка времени ожидания
        self.onTimeouted();
    }
}
```
