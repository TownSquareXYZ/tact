---
title: Жизненный цикл сообщения
description: Каждая транзакция в блокчейне TON имеет несколько этапов, где вычисления и действия являются наиболее важными для жизненного цикла сообщения
---

Существует несколько этапов обработки сообщений контрактом, их больше, но мы сосредоточимся на самых важных:

## Фаза получения

Эта фаза объединяет несколько низкоуровневых этапов. 

Все начинается с добавления значения сообщения **к балансу контракта**. Значение входящего сообщения — это максимальная цена, которую контракт может заплатить за газ для обработки этого сообщения. Контракт может перезаписать этот лимит, но это не рекомендуется и подходит только для продвинутых разработчиков, поскольку это может привести к истощению контракта. 1 миллион газа — это максимальная сумма, которую контракт может потратить в одном контракте, что равно 0,4 TON для бейсчейна (в настоящее время). Если значение сообщения равно нулю, выполнение прерывается.

Затем некоторое (обычно небольшое) количество nanoton вычитается из баланса контракта для хранения. Это означает, что вы не можете идеально предсказать изменения баланса и должны настроить свой код под эту нестабильность.

Затем он развертывает контракт, если он еще не развернут, а сообщение содержит пакет инициализации. Если пакет инициализации отсутствует, он будет проигнорирован.

## Фаза вычисления

На этом этапе выполняется код смарт-контракта и создается список действий или исключений. В настоящее время поддерживаются только два типа действий: **отправить сообщение** и **резерв**.

При отправке сообщения может использоваться фиксированное значение или динамическое значение, например **оставшееся значение сообщения** - оставшееся значение входящего сообщения. Отправка сообщения может осуществляться с флагом `SendIgnoreErrors`, который будет игнорировать ошибки во время отправки сообщения и переходить к следующему действию. Этот флаг полезен, если у вас есть несколько действий. При отправке сообщения с некоторым значением оно сначала вычитает это значение из входящего значения и только затем из баланса контракта (до обработки).

## Фаза действия

Действия выполняются последовательно, но имейте в виду:
**ИСКЛЮЧЕНИЕ ВО ВРЕМЯ ОБРАБОТКИ ДЕЙСТВИЙ НЕ ОТМЕНЯЕТ ТРАНЗАКЦИЮ**

Например, если вы вычтете 1 ton из баланса клиента, а затем отправите недопустимое сообщение, это может привести к ситуации, когда баланс клиента будет вычтен, но он его не получит.
