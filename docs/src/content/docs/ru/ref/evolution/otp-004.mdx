---
title: "OTP-004: Автоматический кодировщик"
description: Это предложение определяет способ автоматического построения схемы сериализации для заданной структуры
sidebar:
  order: 4
---

Этот проект определяет способ автоматического создания схемы сериализации для заданной структуры.

## Мотивация

Разработка схемы сериализации в TLB - очень рискованная задача. Разработчики должны учитывать ограничения по размеру ячеек и помнить, сколько бит используется для каждого поля. Это очень рискованная задача, и в ней очень легко допустить ошибку. Данное предложение направлено на решение этой проблемы путем предоставления способа автоматического создания схемы сериализации для заданной структуры.

## Спецификация

Мы определяем автокодировщик как алгоритм, который быстро создает схему сериализации для заданной структуры. Алгоритм определяется следующим образом:

```text
Определите доступные ссылки и биты в текущей ячейке 
   как `available_references` и `available_bits` соответственно.
   ПРИМЕЧАНИЕ: должна быть зарезервирована по крайней мере одна ссылка для конца сериализации и один
бит для необязательного флага. В зависимости от контекста может быть зарезервировано больше ссылок или бит. 

Для каждого поля в A:
    (size_bits, size_ref) = get_field_max_size(field);
    if (available_bits >= size_bits && available_references >= size_ref) {
        Переместить поле в текущую ячейку
    } else {
        available_references = (1023 - 1);
        available_bits = (4 - 1);
        Выделите новый конец и продолжайте с текущего поля
    }
```

## Недостатки

- Это неявный алгоритм. Неясно, нужно ли проверять результаты этого распределителя, чтобы сделать совместимую сериализацию.
